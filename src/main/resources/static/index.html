<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>CS2 Skin Catalog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin: 24px; }
    .container { max-width: 1100px; margin: 0 auto; }
    .title { margin: 0 0 16px; }
    .table-container { overflow-x: auto; }
    table { width: 100%; border-collapse: collapse; }
    thead th { text-align: left; padding: 10px; border-bottom: 2px solid #ddd; background: #fafafa; }
    tbody td { padding: 10px; border-bottom: 1px solid #eee; vertical-align: top; }
    img { display: block; max-width: 200px; height: auto; object-fit: cover; }
    .controls { margin-bottom: 1em; }
    input[type="text"] { width: 100%; max-width: 400px; padding: 8px 12px; box-sizing: border-box; }
    button { padding: 8px 12px; cursor: pointer; }
    a { color: #0a58ca; text-decoration: none; }
    a:hover { text-decoration: underline; }
  </style>
</head>
<body>
  <div class="container">
    <h1 class="title">CS2 Skin Catalog</h1>

    <div class="controls">
      <input type="text" placeholder="Search skins or guns…" id="searchBox"/>
    </div>
    <div class="toolbar" style="display:flex; align-items:center; gap:12px; margin-bottom:12px;">
        <div class="controls">
        <button id="sortBtn">Sort Price: Ascending</button>
        </div>

        <div class="controls"style="margin-left:auto; display:flex; flex-direction:column; align-items:flex-end; gap:8px; margin-top:12px;">
            <label>
                Page size:
                <select id="sizeSel">
                <option>10</option>
                <option selected>25</option>
                <option>50</option>
                <option>100</option>
                </select>
            </label>

            <div style="display:flex; align-items:right; gap:8px;">
                <button id="prevBtn">‹ Prev</button>
                <div id="pages" style="display:flex; gap:4px;"></div>
                <button id="nextBtn">Next ›</button>
            </div>
        </div>
    </div>

    <div class="table-container">
      <table class="skins-table">
        <thead>
          <tr>
            <th>Preview</th>
            <th>Skin Name</th>
            <th>Gun</th>
            <th>Rarity</th>
            <th>Collection</th>
            <th>Price</th>
          </tr>
        </thead>
        <tbody>
        </tbody>
      </table>
    </div>
  </div>
</body>
<script>
    let sortAsc = false;
    let query = '';
    let pageNum = 0;
    let pageSize = 25;
    let debounceTimer;
    let lastPageMeta = { first: true, last: true };

    async function loadSkins() {
        const order = sortAsc ? 'asc' : 'desc';
        const params = new URLSearchParams({
            sort: `priceNum,${order}`,
            page: String(pageNum),
            size: String(pageSize)
        })
        if (query.trim()) params.set('q', query.trim());
        const res = await fetch(`/api/skins?${params.toString()}`);
        const page = await res.json();
        lastPageMeta = { first: page.first === true, last: page.last === true };
        const skins = page.content;
        renderTable(skins);
        renderPageState();
    }

    function renderPageState() {
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const sizeSel = document.getElementById('sizeSel');

        prevBtn.disabled = lastPageMeta.first;
        nextBtn.disabled = lastPageMeta.last;

        sizeSel.value = String(pageSize);
    }

    function renderTable(skins) {
        const tbody = document.querySelector('.skins-table tbody');
        tbody.innerHTML = '';

        skins.forEach(skin => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
            <td><img src="${skin.image_url || ''}" alt="${skin.skin_name || ''}" width="200"/></td>
            <td><a href="/skin.html?id=${skin.id}">${skin.skin_name || ''}</a></td>
            <td>${skin.gun_name || ''}</td>
            <td>${skin.rarity || ''}</td>
            <td>${skin.collection || ''}</td>
            <td>${skin.price || ''}</td>
        `;
        tbody.appendChild(tr);
        });
    }

    document.addEventListener("DOMContentLoaded", () => {
        const sortBtn = document.getElementById("sortBtn");
        const searchBox = document.getElementById("searchBox");
        const prevBtn = document.getElementById("prevBtn");
        const nextBtn = document.getElementById("nextBtn");
        const sizeSel = document.getElementById("sizeSel");

        sortBtn.addEventListener("click", () => {
            sortAsc = !sortAsc;
            sortBtn.textContent = sortAsc ? "Sort Price: Ascending" : "Sort Price: Descending";
            loadSkins();
        });

        searchBox.addEventListener('input', () => {
        clearTimeout(debounceTimer);
        debounceTimer = setTimeout(() => {
            query = searchBox.value;
            pageNum = 0;
            loadSkins();
        }, 300);
        });

        prevBtn.addEventListener('click', () => {
            if (!lastPageMeta.first && pageNum > 0) {
            pageNum -= 1;
            loadSkins();
            }
        });

        nextBtn.addEventListener('click', () => {
            if (!lastPageMeta.last) {
            pageNum += 1;
            loadSkins();
            }
        });
        
        sizeSel.addEventListener('change', () => {
            pageSize = parseInt(sizeSel.value, 10) || 25;
            pageNum = 0;
            loadSkins();
        });

        loadSkins();
    });
</script>
    
</html>
